{% extends "page.html" %}

{% block secondary_content %}
    {% include "reports/nav.html" %}
{% endblock %}

{% block primary %}
<link href="c3.min.css" rel="stylesheet">
<script src="/js/d3.min.js"></script>
<script src="/js/c3.min.js"></script>

<script>
const monthNames = ["Jan", "Feb", "Mar", "Apr", "May", "Jun",
                    "Jul", "Aug", "Sep", "Oct", "Nov", "Dec"];
</script>

<div class="primary col-sm-9 col-xs-12 report">
    <h1>Publishing history</h1>
    <p>Shows the publishing and updating of dataset records over time</p>

    {% for organisation in c.organisation_list %}
        <h3>{{ organisation.title }} </h3>

        <div id="chart_{{organisation.id}}"></div>
        <script>
            c3.generate({
                bindto: '#chart_{{organisation.id}}',
                data: {
                   x: 'x',
                   columns: [
                        ['x', '2018-01-01', '2018-02-01', '2018-03-01',
                              '2018-04-01', '2018-05-01', '2018-06-01',
                              '2018-07-01', '2018-08-01', '2018-09-01',
                              '2018-10-01', '2018-11-01', '2018-12-01'],
                        {{ h.publishing_stats(organisation.name, "additions") | safe }},
                        {{ h.publishing_stats(organisation.name, "updates") | safe }}
                    ]
                },
                axis : {
                    x : {
                        type : 'timeseries',
                        tick: {
                            format: function (x) { return monthNames[x.getMonth()] + " " + x.getFullYear(); }
                        }
                    }
                }
            });
        </script>
        <hr/>
    {% endfor %}
</div>
{% endblock %}